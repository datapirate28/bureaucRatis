<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>bureaucRatis</title>
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React & ReactDOM Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>

    <!-- 3. Babel for JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* Smooth fade for elements */
        .fade-enter { opacity: 0; transform: translateY(10px); }
        .fade-enter-active { opacity: 1; transform: translateY(0); transition: opacity 300ms, transform 300ms; }
        
        /* Creative Nav Blur - Light */
        .nav-glass-light {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
        }

        /* Creative Nav Blur - Dark (Redesigned) */
        .nav-glass-dark {
            background: rgba(10, 10, 10, 0.5); 
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
        }

        /* Content Glass Panels */
        .glass-panel-light {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .glass-panel-dark {
            background: rgba(20, 20, 25, 0.6);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Custom Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        .animate-float {
            animation: float 6s ease-in-out infinite;
        }
        .animate-float-delayed {
            animation: float 6s ease-in-out 3s infinite;
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-slide-up {
            animation: slideUp 0.8s ease-out forwards;
        }

        /* Stagger Delays */
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }
        .delay-500 { animation-delay: 500ms; }
        .delay-700 { animation-delay: 700ms; }
        .delay-1000 { animation-delay: 1000ms; }
    </style>
</head>
<body class="font-sans overflow-x-hidden transition-colors duration-500">
    <div id="root"></div>

    <!-- Error Handler -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            if (document.getElementById('root').innerHTML === "") {
                console.error(message);
            }
        };
    </script>

    <!-- 4. Application Logic -->
    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect, useMemo, useRef } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            BookOpen, Repeat, Link as LinkIcon, ArrowLeftRight, MessageCircle, 
            Plus, Check, X, Save, Trash2, Brain, TrendingUp, Clock, 
            Search, Sparkles, Zap, Layers, Loader2, AlertTriangle, User, 
            LogOut, ShieldCheck, LogIn, ChevronDown, Play, ArrowLeft, Trophy, 
            Book, Mic, Volume2, Wand2, Star, ChevronRight, Activity, Grid, List,
            Moon, Sun, Upload, Pencil
        } from 'lucide-react';
        
        // Import Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged,
            signInWithCustomToken,
            GoogleAuthProvider,
            signInWithPopup,
            linkWithPopup,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            query, 
            onSnapshot, 
            deleteDoc, 
            doc, 
            getDoc,
            setDoc,
            updateDoc,
            serverTimestamp 
        } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        // --- FIREBASE SETUP ---
        const getFirebaseConfig = () => {
            if (typeof __firebase_config !== 'undefined') {
                return JSON.parse(__firebase_config);
            }
            // Fallback for demo/dev if config not injected
            return {
                apiKey: "AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM",
                authDomain: "bureaucratis-6a362.firebaseapp.com",
                projectId: "bureaucratis-6a362",
                storageBucket: "bureaucratis-6a362.firebasestorage.app",
                messagingSenderId: "310102127551",
                appId: "1:310102127551:web:bb5994c0e73b952804a70a",
                measurementId: "G-PEGW7J88ZW"
            };
        };

        const firebaseConfig = getFirebaseConfig();
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'fluency-flow-standalone';

        // --- UTILS ---
        const calculateNextReview = (rating, previousInterval, previousEasiness) => {
            let newInterval;
            let newEasiness = previousEasiness + (0.1 - (5 - rating) * (0.08 + (5 - rating) * 0.02));
            if (newEasiness < 1.3) newEasiness = 1.3;
            if (rating < 3) { newInterval = 1; } 
            else {
                if (previousInterval === 0) newInterval = 1;
                else if (previousInterval === 1) newInterval = 6;
                else newInterval = Math.round(previousInterval * newEasiness);
            }
            return { interval: newInterval, easiness: newEasiness };
        };

        const getRelativeTime = (timestamp) => {
            const diff = timestamp - Date.now();
            if (diff < 0) return 'Ready now';
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            if (days > 0) return `in ${days}d`;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            return `in ${hours}h`;
        };

        const speakText = (text, onError) => {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                window.speechSynthesis.speak(utterance);
                return true;
            } else {
                if (onError) onError("Text-to-speech is not supported in this browser.");
                return false;
            }
        };

        const getMasteryStars = (interval) => {
            if (interval > 21) return 5;
            if (interval > 10) return 4;
            if (interval > 4) return 3;
            if (interval > 1) return 2;
            return 1;
        };

        // --- COMPONENTS ---

        const ItemCard = ({ title, subtitle, icon: Icon, colorClass, onDelete, onSpeak, onEdit, interval, type, theme }) => {
            const gradients = {
                voca: "from-indigo-500 to-blue-500",
                synonym: "from-violet-500 to-purple-500",
                antonym: "from-rose-500 to-pink-500",
                phrase: "from-amber-400 to-orange-500"
            };

            const bgGradient = gradients[type] || "from-slate-500 to-slate-600";
            
            // Modern Dark Mode Card: Darker bg, subtle border, deeper shadow
            const cardClass = theme === 'dark' 
                ? "bg-[#16161a]/60 border-white/5 shadow-lg hover:bg-[#1c1c21]/80 hover:shadow-indigo-500/10 hover:border-white/10" 
                : "bg-white border-slate-100 shadow-[0_4px_20px_-4px_rgba(0,0,0,0.05)] hover:shadow-[0_8px_30px_-4px_rgba(0,0,0,0.1)]";

            const textMain = theme === 'dark' ? "text-gray-100" : "text-slate-800";
            const textSub = theme === 'dark' ? "text-gray-400" : "text-slate-500";
            const btnBg = theme === 'dark' ? "bg-white/5 hover:bg-indigo-500/20 text-gray-400 hover:text-indigo-300" : "bg-slate-50 hover:bg-indigo-50 text-slate-400 hover:text-indigo-600";

            return (
                <div className={`${cardClass} p-4 rounded-3xl border flex items-center gap-5 transition-all duration-300 group`}>
                    <div className={`w-20 h-20 rounded-2xl bg-gradient-to-br ${bgGradient} flex items-center justify-center text-white shadow-md shrink-0`}>
                        <Icon className="w-8 h-8" />
                    </div>
                    <div className="flex-1 min-w-0">
                        <h4 className={`text-xl font-bold ${textMain} truncate`}>{title}</h4>
                        <p className={`${textSub} text-sm font-medium mt-1 truncate`}>{subtitle}</p>
                    </div>
                    <div className="flex flex-col gap-2">
                        {onSpeak && (
                            <button onClick={onSpeak} className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${btnBg}`}>
                                <Volume2 className="w-5 h-5" />
                            </button>
                        )}
                        {onEdit && (
                            <button onClick={onEdit} className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors ${btnBg}`}>
                                <Pencil className="w-5 h-5" />
                            </button>
                        )}
                        <button onClick={onDelete} className={`w-10 h-10 rounded-full flex items-center justify-center transition-colors opacity-0 group-hover:opacity-100 ${theme === 'dark' ? 'bg-white/5 hover:bg-rose-500/20 text-gray-400 hover:text-rose-400' : 'bg-slate-50 hover:bg-rose-50 text-slate-400 hover:text-rose-600'}`}>
                            <Trash2 className="w-5 h-5" />
                        </button>
                    </div>
                </div>
            );
        };

        // --- LOGIN PAGE DESIGN (RESPONSIVE) ---
        const LoginPage = ({ onLogin, error }) => (
            <div className="min-h-screen flex flex-col items-center justify-center font-sans bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 relative overflow-hidden p-4 sm:p-6 md:p-8">
                
                {/* Background decorative elements */}
                <div className="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
                    <div className="absolute top-[10%] left-[10%] w-64 h-64 bg-white/40 rounded-full blur-3xl animate-pulse"></div>
                    <div className="absolute bottom-[10%] right-[10%] w-80 h-80 bg-purple-300/30 rounded-full blur-3xl animate-float"></div>
                    <div className="absolute top-[40%] left-[60%] w-40 h-40 bg-pink-300/30 rounded-full blur-3xl"></div>
                </div>

                {/* Main Content Container - switched to lg:flex-row for better tablet/desktop spacing */}
                <div className="relative z-10 w-full max-w-7xl flex flex-col lg:flex-row items-center justify-between gap-10 lg:gap-16">
                    
                    {/* Left/Top Side: Visuals & Brand */}
                    <div className="flex-1 w-full flex flex-col items-center lg:items-start text-center lg:text-left">
                        
                        {/* Brand Logo - Centered on mobile, Left on Desktop */}
                        <div className="mb-6 md:mb-10 animate-slide-up self-center lg:self-start">
                            {/* PLACEHOLDER FOR LOGO IMAGE - UPLOAD YOUR LOGO HERE */}
                            <img src="2.jpg" alt="FluencyFlow Logo" className="h-16 md:h-20 w-auto object-contain rounded-full shadow-2xl" />
                        </div>

                        <h2 className="font-black text-slate-900 mb-4 md:mb-6 leading-tight animate-slide-up delay-100 flex flex-col gap-2">
                            {/* Responsive Text Sizes: starts smaller on mobile, grows on larger screens */}
                            <span className="text-5xl sm:text-6xl md:text-7xl lg:text-8xl font-black text-slate-900 tracking-tight">bureaucRatis</span>
                            <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 text-2xl sm:text-3xl md:text-4xl lg:text-5xl font-bold">The Smart Way</span>
                        </h2>
                        
                        <p className="text-slate-600 text-base sm:text-lg md:text-xl leading-relaxed mb-6 md:mb-8 max-w-lg font-medium animate-slide-up delay-200">
                            <span className="font-bold text-slate-400 hover:text-indigo-600 hover:cursor-pointer transition-all duration-1000">By Hashmatullah Naybi</span>
                        </p>

                        {/* Call to Action Section */}
                        <div className="w-full max-w-md animate-slide-up delay-300">
                            <div className="bg-white/60 backdrop-blur-xl border border-white/60 p-6 md:p-8 rounded-[2rem] shadow-xl relative overflow-hidden group hover:bg-white/70 transition-all duration-300">
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                                
                                <p className="text-center text-slate-800 font-bold text-base md:text-lg mb-6">
                                    Continue with Google â€” <span className="text-indigo-600 block sm:inline">Make a free account.</span>
                                </p>

                                <button onClick={onLogin} className="w-full bg-slate-900 hover:bg-slate-800 text-white font-bold py-3 md:py-4 rounded-xl flex items-center justify-center gap-3 transition-all hover:scale-[1.02] shadow-lg active:scale-95 group-hover:shadow-indigo-500/20 text-sm md:text-base">
                                    <div className="p-1 md:p-1.5 bg-white rounded-full">
                                        <svg className="w-4 h-4 md:w-5 md:h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                                    </div>
                                    <span>Continue with Google</span>
                                </button>
                                
                                {error && <div className="mt-4 p-3 bg-red-50 text-red-600 text-xs font-bold rounded-lg text-center border border-red-100">{error}</div>}
                            </div>
                        </div>
                    </div>

                    {/* Right/Bottom Side: Animation */}
                    <div className="flex-1 flex justify-center items-center relative animate-float-delayed w-full mt-10 lg:mt-0">
                         {/* Abstract 3D-ish Composition - Responsive sizes */}
                         <div className="relative w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96">
                            
                            {/* Main Purple Block (Brain) */}
                            <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-40 h-40 sm:w-48 sm:h-48 bg-gradient-to-br from-indigo-500 to-violet-600 rounded-[2rem] shadow-2xl flex items-center justify-center z-20 animate-float border-4 border-white/20">
                                <Brain className="w-20 h-20 sm:w-24 sm:h-24 text-white stroke-[1.5]" />
                            </div>

                            {/* Floating Elements mimicking screenshot - Repositioned for responsiveness */}
                            
                            {/* Pink Circle */}
                            <div className="absolute top-0 left-4 sm:left-10 w-12 h-12 sm:w-16 sm:h-16 bg-pink-400 rounded-full shadow-lg opacity-90 animate-float-delayed" style={{animationDuration: '5s'}}></div>
                            
                            {/* White Square (Book) */}
                            <div className="absolute top-4 right-4 sm:right-10 w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-2xl shadow-xl flex items-center justify-center animate-float" style={{animationDuration: '7s', animationDelay: '1s'}}>
                                <BookOpen className="w-8 h-8 sm:w-10 sm:h-10 text-indigo-500" />
                            </div>

                            {/* White Square (Link) */}
                            <div className="absolute bottom-6 sm:bottom-10 left-0 w-16 h-16 sm:w-20 sm:h-20 bg-white rounded-2xl shadow-xl flex items-center justify-center animate-float-delayed" style={{animationDuration: '6s', animationDelay: '0.5s'}}>
                                <LinkIcon className="w-8 h-8 sm:w-10 sm:h-10 text-violet-500" />
                            </div>

                            {/* Blue Diamond */}
                            <div className="absolute bottom-16 sm:bottom-20 right-4 w-10 h-10 sm:w-14 sm:h-14 bg-indigo-400 rounded-xl shadow-lg transform rotate-45 animate-float" style={{animationDuration: '4s', animationDelay: '1.5s'}}></div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const Navigation = ({ activeTab, setActiveTab, user, onLogout, items, streak, theme, toggleTheme }) => {
            const navItems = [
                { id: 'dashboard', label: 'Dashboard', icon: Grid },
                { id: 'voca', label: 'Vocab', icon: Book }, // Changed from "Voca" to "Vocab"
                { id: 'synonyms', label: 'Synonyms', icon: LinkIcon },
                { id: 'antonyms', label: 'Antonyms', icon: ArrowLeftRight },
                { id: 'phrases', label: 'Phrases', icon: MessageCircle },
            ];
            const level = Math.floor((items?.length || 0) / 5) + 1;

            const navClass = theme === 'dark' ? 'nav-glass-dark' : 'nav-glass-light';
            // Dark Mode: White text for base. Light Mode: Slate 600.
            const textBase = theme === 'dark' ? 'text-gray-300' : 'text-slate-600';
            const textHover = theme === 'dark' ? 'hover:text-white hover:bg-white/10' : 'hover:text-slate-900 hover:bg-white/40';
            // Dark Mode Active: Bright Indigo gradient or solid punchy color.
            const activeClass = theme === 'dark' 
                ? 'bg-gradient-to-r from-indigo-600 to-violet-600 text-white shadow-[0_0_15px_rgba(99,102,241,0.5)] border border-white/10' 
                : 'bg-slate-900 text-white shadow-xl';
            
            const logoColor = theme === 'dark' ? 'text-indigo-400' : 'text-indigo-600';
            // Dark Mode Logo: Lighter gradient to pop against dark bg
            const logoGradient = theme === 'dark' ? 'bg-gradient-to-r from-indigo-300 via-purple-300 to-pink-300' : 'bg-gradient-to-r from-indigo-600 to-violet-600';

            return (
                <>
                    <div className="fixed top-0 left-0 right-0 z-50 px-4 py-4 md:px-8">
                        <div className={`max-w-6xl mx-auto ${navClass} rounded-full px-6 py-3 flex justify-between items-center transition-all duration-300`}>
                            <div className={`flex items-center gap-2 font-black text-xl md:text-2xl cursor-pointer shrink-0 tracking-tight text-transparent bg-clip-text ${logoGradient}`} onClick={() => setActiveTab('landing')}>
                                <img src="2.jpg" alt="bureaucRatis Logo" className="w-[40px] h-[40px] rounded-full" />
                                <span className="hidden md:inline">bureaucRatis</span>
                            </div>
                            
                            <div className="flex space-x-1 overflow-x-auto no-scrollbar mx-4">
                                {navItems.map((item) => (
                                <button 
                                    key={item.id} 
                                    onClick={() => setActiveTab(item.id)} 
                                    className={`flex items-center gap-2 px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ${
                                        activeTab === item.id 
                                        ? `${activeClass} scale-105` 
                                        : `${textBase} ${textHover}`
                                    }`}
                                >
                                    <item.icon className="w-4 h-4" /> <span className="hidden sm:inline">{item.label}</span>
                                </button>
                                ))}
                            </div>

                            <div className="relative group z-50">
                                {user?.isAnonymous ? (
                                    <button onClick={onLogout} className="flex items-center gap-2 text-xs font-bold bg-white/20 px-4 py-2 rounded-full hover:bg-white/30 transition-colors border border-white/20 text-current"><User className="w-4 h-4" /><span>Guest</span></button>
                                ) : (
                                    <div>
                                        <button className={`flex items-center gap-2 text-xs font-bold ${textBase} bg-white/5 border border-white/10 px-3 py-1.5 rounded-full hover:bg-white/10 transition-all backdrop-blur-md shadow-sm`}>
                                            <img src={user?.photoURL} className="w-7 h-7 rounded-full border border-white/20" onError={(e) => e.target.style.display='none'} />
                                            <span>{user?.displayName?.split(' ')[0] || 'User'}</span><ChevronDown className="w-3 h-3 opacity-70" />
                                        </button>
                                        <div className="absolute right-0 top-full mt-3 w-64 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform origin-top-right">
                                            <div className={`${theme === 'dark' ? 'bg-[#0f172a]/95 border-white/10' : 'bg-white/90 border-white'} backdrop-blur-xl rounded-3xl shadow-[0_20px_50px_-12px_rgba(0,0,0,0.5)] border p-5 overflow-hidden relative`}>
                                                <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
                                                <div className="flex items-center gap-3 mb-4">
                                                    <div className={`w-12 h-12 ${theme === 'dark' ? 'bg-white/10 text-indigo-300' : 'bg-indigo-50 text-indigo-600'} rounded-2xl flex items-center justify-center text-2xl shadow-sm animate-pulse`}>ðŸ¦Š</div>
                                                    <div><div className={`text-[10px] font-bold uppercase tracking-wider ${theme==='dark'?'text-gray-400':'text-slate-400'}`}>Level {level} Scholar</div><div className={`font-bold text-sm ${theme==='dark'?'text-white':'text-slate-800'}`}>Hi, {user?.displayName?.split(' ')[0]}!</div></div>
                                                </div>
                                                <div className={`${theme==='dark'?'bg-white/5 border-white/5':'bg-slate-50 border-slate-100'} rounded-2xl p-3 mb-4 flex items-center justify-between border`}>
                                                    <div className="text-left"><div className="text-[10px] text-slate-500 font-bold uppercase">Words</div><div className={`text-xl font-black leading-none ${theme==='dark'?'text-indigo-400':'text-indigo-600'}`}>{items?.length || 0}</div></div>
                                                    <div className={`text-left border-l ${theme==='dark'?'border-white/10':'border-slate-200'} pl-3`}><div className="text-[10px] text-slate-500 font-bold uppercase">Streak</div><div className="text-xl font-black text-orange-500 leading-none">ðŸ”¥ {streak}</div></div>
                                                </div>
                                                <button onClick={onLogout} className={`w-full flex items-center justify-center gap-2 py-3 rounded-xl font-bold text-xs transition-all hover:scale-[1.02] shadow-lg ${theme==='dark'?'bg-indigo-600 text-white hover:bg-indigo-500':'bg-slate-900 text-white hover:bg-slate-800'}`}><LogOut className="w-3 h-3" /> Sign Out</button>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    {/* Floating Theme Toggle Beneath Nav */}
                    <div className="fixed top-24 right-4 md:right-8 z-40 animate-slide-up delay-500">
                        <button 
                            onClick={toggleTheme} 
                            className={`p-2.5 rounded-full transition-all duration-300 shadow-xl border backdrop-blur-md ${theme === 'dark' ? 'bg-[#0f172a]/80 border-white/10 text-yellow-400 hover:bg-[#1e293b] hover:border-yellow-400/50 hover:shadow-yellow-400/20' : 'bg-white/80 border-white text-indigo-600 hover:bg-white'}`}
                            title={theme === 'dark' ? "Switch to Light Mode" : "Switch to Dark Mode"}
                        >
                            {theme === 'dark' ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
                        </button>
                    </div>
                </>
            );
        };

        // ... LandingPage, Dashboard, VocaManager ...
        // (Applying theme props to all of them)

        const LandingPage = ({ setActiveTab, theme }) => {
            const textColor = theme === 'dark' ? 'text-white' : 'text-slate-800';
            const subTextColor = theme === 'dark' ? 'text-gray-300' : 'text-slate-600';
            const cardBgClass = theme === 'dark' ? 'glass-panel-dark' : 'glass-panel-light';
            const iconBg = theme === 'dark' ? 'bg-slate-800 text-indigo-400' : 'bg-indigo-100 text-indigo-600';
            
            // Dark mode Hero text gradient: Brighter to stand out
            const heroGradient = theme === 'dark' ? 'from-indigo-300 via-cyan-300 to-emerald-300' : 'from-indigo-100 to-purple-200';

            return (
                <div className="flex flex-col min-h-screen pt-44 pb-12 px-4 relative z-10">
                    <div className="flex-1 flex flex-col items-center justify-center text-center space-y-8 mb-20">
                        <h1 className="text-6xl md:text-8xl font-black text-white tracking-tighter drop-shadow-sm leading-tight max-w-5xl mx-auto opacity-0 animate-slide-up">
                            Solidify Your <br/>
                            <span className={`text-transparent bg-clip-text bg-gradient-to-r ${heroGradient}`}>Vocabulary</span>
                        </h1>
                        <p className="text-xl md:text-2xl text-white/90 max-w-3xl mx-auto font-light leading-relaxed opacity-0 animate-slide-up delay-200">
                            The simple way to master words, phrases, synonyms, and antonyms. Donâ€™t just learn new vocabularyâ€”keep it forever.
                        </p>
                        <div className="mt-8 opacity-0 animate-slide-up delay-300">
                            <button onClick={() => setActiveTab('dashboard')} className="group px-12 py-5 rounded-2xl font-bold text-xl bg-white text-indigo-900 shadow-xl hover:shadow-white/30 hover:scale-105 active:scale-95 transition-all flex items-center gap-3 relative overflow-hidden">
                                <span className="relative z-10">Start Learning Now</span>
                                <ArrowLeft className="w-5 h-5 rotate-180 relative z-10 group-hover:translate-x-1 transition-transform" />
                                <div className="absolute inset-0 bg-gradient-to-r from-white via-indigo-50 to-white opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            </button>
                        </div>
                    </div>

                    {/* Key Features Section */}
                    <div className="max-w-7xl mx-auto w-full mb-20">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div className={`${cardBgClass} p-8 rounded-[2rem] hover:transform hover:-translate-y-2 transition-all duration-500 hover:shadow-2xl opacity-0 animate-slide-up delay-500`}>
                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center mb-6 animate-float ${theme==='dark'?'bg-indigo-500/20 text-indigo-300':'bg-indigo-100 text-indigo-600'}`}>
                                    <Book className="w-8 h-8" />
                                </div>
                                <h3 className={`text-2xl font-bold mb-3 ${textColor}`}>Build Your Dictionary</h3>
                                <p className={`${subTextColor} leading-relaxed`}>Save every new word and phrase you encounter in one organized, beautiful place.</p>
                            </div>
                            <div className={`${cardBgClass} p-8 rounded-[2rem] hover:transform hover:-translate-y-2 transition-all duration-500 hover:shadow-2xl opacity-0 animate-slide-up delay-700`}>
                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center mb-6 animate-float-delayed ${theme==='dark'?'bg-purple-500/20 text-purple-300':'bg-purple-100 text-purple-600'}`}>
                                    <LinkIcon className="w-8 h-8" />
                                </div>
                                <h3 className={`text-2xl font-bold mb-3 ${textColor}`}>Connect the Dots</h3>
                                <p className={`${subTextColor} leading-relaxed`}>Link words to their synonyms and antonyms so you understand the exact meaning and nuance.</p>
                            </div>
                            <div className={`${cardBgClass} p-8 rounded-[2rem] hover:transform hover:-translate-y-2 transition-all duration-500 hover:shadow-2xl opacity-0 animate-slide-up delay-1000`}>
                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center mb-6 animate-float ${theme==='dark'?'bg-emerald-500/20 text-emerald-300':'bg-emerald-100 text-emerald-600'}`}>
                                    <Brain className="w-8 h-8" />
                                </div>
                                <h3 className={`text-2xl font-bold mb-3 ${textColor}`}>Test Your Memory</h3>
                                <p className={`${subTextColor} leading-relaxed`}>Use our built-in tools to practice and ensure you never forget what you have learned.</p>
                            </div>
                        </div>
                    </div>

                    {/* How It Works Section */}
                    <div className="max-w-5xl mx-auto w-full mb-20 text-center">
                        <h2 className="text-4xl font-bold text-white mb-12 opacity-0 animate-slide-up delay-1000">How It Works</h2>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                            <div className="bg-white/10 backdrop-blur-sm p-6 rounded-3xl border border-white/10 opacity-0 animate-slide-up delay-[1100ms] hover:bg-white/20 transition-colors duration-300">
                                <div className="text-5xl font-black text-white/20 mb-4">01</div>
                                <h4 className="text-xl font-bold text-white mb-2">Add</h4>
                                <p className="text-white/80">Input a new word or phrase quickly.</p>
                            </div>
                            <div className="bg-white/10 backdrop-blur-sm p-6 rounded-3xl border border-white/10 opacity-0 animate-slide-up delay-[1200ms] hover:bg-white/20 transition-colors duration-300">
                                <div className="text-5xl font-black text-white/20 mb-4">02</div>
                                <h4 className="text-xl font-bold text-white mb-2">Refine</h4>
                                <p className="text-white/80">Add details like definitions, synonyms, and antonyms.</p>
                            </div>
                            <div className="bg-white/10 backdrop-blur-sm p-6 rounded-3xl border border-white/10 opacity-0 animate-slide-up delay-[1300ms] hover:bg-white/20 transition-colors duration-300">
                                <div className="text-5xl font-black text-white/20 mb-4">03</div>
                                <h4 className="text-xl font-bold text-white mb-2">Solidify</h4>
                                <p className="text-white/80">Practice regularly until it sticks.</p>
                            </div>
                        </div>
                    </div>

                    {/* Footer CTA */}
                    <div className="text-center py-10 border-t border-white/10 opacity-0 animate-slide-up delay-[1400ms]">
                        <h3 className="text-12xl font-bold text-white mb-6"> "My words fly up, my thoughts remain below. Words without thoughts never to heaven go."</h3>
                        <p className="text-white/80 mb-6">â€” William Shakespeare</p>
                    </div>
                </div>
            )
        }

        // Generic Container for all managers to handle Theme
        const ManagerContainer = ({ children, title, subtitle, theme, headerAction }) => {
            const containerClass = theme === 'dark' ? 'glass-panel-dark' : 'glass-panel-light';
            const titleColor = theme === 'dark' ? 'text-white' : 'text-slate-800';
            const subColor = theme === 'dark' ? 'text-gray-400' : 'text-slate-600';

            return (
                <div className={`${containerClass} p-8 rounded-[2rem] shadow-xl transition-all duration-500`}>
                    <div className="mb-8 flex items-start justify-between">
                        <div>
                            <h3 className={`text-3xl font-black ${titleColor} tracking-tight mb-2`}>{title}</h3>
                            <p className={`${subColor} font-medium`}>{subtitle}</p>
                        </div>
                        {headerAction && <div className="flex items-center gap-2">{headerAction}</div>}
                    </div>
                    {children}
                </div>
            );
        };

        const Dashboard = ({ items, onReview, dueCount, onLoadDemo, isAdding, onFlashcards, theme }) => {
            const stats = useMemo(() => {
                const total = items.length;
                const mastered = items.filter(i => i.interval > 21).length;
                const learning = total - mastered;
                return { total, mastered, learning };
            }, [items]);

            const [showFlashcardModal, setShowFlashcardModal] = useState(false);
            const [showReviewModal, setShowReviewModal] = useState(false);
            const dueItems = items.filter(i => i.nextReview < Date.now());
            const vocaDue = dueItems.filter(i => i.type === 'voca').length;
            const synonymDue = dueItems.filter(i => i.type === 'synonym').length;
            const antonymDue = dueItems.filter(i => i.type === 'antonym').length;
            const phraseDue = dueItems.filter(i => i.type === 'phrase').length;

            const cardBg = theme === 'dark' ? 'glass-panel-dark' : 'glass-panel-light';
            const textColor = theme === 'dark' ? 'text-white' : 'text-slate-800';
            const subText = theme === 'dark' ? 'text-gray-400' : 'text-slate-500';

            return (
                <div className="space-y-8 animate-in fade-in duration-500 pb-10 pt-24 max-w-6xl mx-auto px-4">
                    {/* Flashcard Modal */}
                    {showFlashcardModal && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-in fade-in zoom-in-95">
                            <div className={`${theme === 'dark' ? 'bg-[#0f172a] border-white/10' : 'bg-white'} border rounded-3xl p-8 max-w-sm w-full shadow-2xl relative`}>
                                <button onClick={() => setShowFlashcardModal(false)} className={`absolute top-4 right-4 ${theme==='dark'?'text-gray-400 hover:text-white':'text-slate-400 hover:text-slate-600'}`}><X className="w-6 h-6"/></button>
                                <div className="text-center mb-6">
                                    <div className="w-16 h-16 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto mb-4"><Layers className="w-8 h-8" /></div>
                                    <h3 className={`text-2xl font-black ${theme==='dark'?'text-white':'text-slate-800'}`}>Flashcard Practice</h3>
                                    <p className="text-slate-500 mt-2">Drill 20 random cards. No grading.</p>
                                </div>
                                <div className="space-y-2">
                                    <button onClick={() => { onFlashcards('voca'); setShowFlashcardModal(false); }} className="w-full bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex items-center justify-center gap-3 transition-colors border border-indigo-100"><Book className="w-5 h-5"/> Vocabulary</button>
                                    <button onClick={() => { onFlashcards('synonym'); setShowFlashcardModal(false); }} className="w-full bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex items-center justify-center gap-3 transition-colors border border-indigo-100"><LinkIcon className="w-5 h-5"/> Synonyms</button>
                                    <button onClick={() => { onFlashcards('antonym'); setShowFlashcardModal(false); }} className="w-full bg-rose-50 hover:bg-rose-100 text-rose-700 font-bold py-3 rounded-xl flex items-center justify-center gap-3 transition-colors border border-rose-100"><ArrowLeftRight className="w-5 h-5"/> Antonyms</button>
                                    <button onClick={() => { onFlashcards('phrase'); setShowFlashcardModal(false); }} className="w-full bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex items-center justify-center gap-3 transition-colors border border-indigo-100"><MessageCircle className="w-5 h-5"/> Phrases</button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Review Modal */}
                    {showReviewModal && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center bg-black/60 backdrop-blur-md p-4 animate-in fade-in zoom-in-95">
                            <div className={`${theme === 'dark' ? 'bg-[#0f172a] border-white/10' : 'bg-white'} border rounded-3xl p-8 max-w-sm w-full shadow-2xl relative`}>
                                <button onClick={() => setShowReviewModal(false)} className={`absolute top-4 right-4 ${theme==='dark'?'text-gray-400 hover:text-white':'text-slate-400 hover:text-slate-600'}`}><X className="w-6 h-6"/></button>
                                <div className="text-center mb-6">
                                    <div className="w-16 h-16 bg-indigo-100 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-4"><Repeat className="w-8 h-8" /></div>
                                    <h3 className={`text-2xl font-black ${theme==='dark'?'text-white':'text-slate-800'}`}>Spaced Repetition</h3>
                                    <p className="text-slate-500 mt-2">Review due words and grade yourself.</p>
                                </div>
                                <div className="space-y-3">
                                    <button onClick={() => { onReview('all'); setShowReviewModal(false); }} className="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-4 rounded-xl flex items-center justify-center gap-3 transition-colors border border-slate-200"><Brain className="w-5 h-5"/> Review All ({dueItems.length})</button>
                                    <div className="grid grid-cols-2 gap-2">
                                        <button onClick={() => { onReview('voca'); setShowReviewModal(false); }} disabled={vocaDue === 0} className="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex flex-col items-center justify-center gap-1 transition-colors border border-indigo-100 disabled:opacity-50"><Book className="w-4 h-4"/> <span className="text-xs">Vocab({vocaDue})</span></button>
                                        <button onClick={() => { onReview('synonym'); setShowReviewModal(false); }} disabled={synonymDue === 0} className="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex flex-col items-center justify-center gap-1 transition-colors border border-indigo-100 disabled:opacity-50"><LinkIcon className="w-4 h-4"/> <span className="text-xs">Syn ({synonymDue})</span></button>
                                        <button onClick={() => { onReview('antonym'); setShowReviewModal(false); }} disabled={antonymDue === 0} className="bg-rose-50 hover:bg-rose-100 text-rose-700 font-bold py-3 rounded-xl flex flex-col items-center justify-center gap-1 transition-colors border border-rose-100 disabled:opacity-50"><ArrowLeftRight className="w-4 h-4"/> <span className="text-xs">Ant ({antonymDue})</span></button>
                                        <button onClick={() => { onReview('phrase'); setShowReviewModal(false); }} disabled={phraseDue === 0} className="bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-bold py-3 rounded-xl flex flex-col items-center justify-center gap-1 transition-colors border border-indigo-100 disabled:opacity-50"><MessageCircle className="w-4 h-4"/> <span className="text-xs">Phr ({phraseDue})</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Welcome Banner */}
                    <div className="relative overflow-hidden bg-gradient-to-br from-violet-600 via-indigo-600 to-blue-600 rounded-[2.5rem] p-10 text-white shadow-2xl">
                        <div className="absolute top-0 right-0 -mt-10 -mr-10 w-60 h-60 bg-white/10 rounded-full blur-3xl"></div>
                        <div className="absolute bottom-0 left-0 -mb-10 -ml-10 w-60 h-60 bg-purple-500/20 rounded-full blur-3xl"></div>
                        <div className="relative z-10">
                            <h2 className="text-4xl font-bold mb-3 tracking-tight">Welcome back!</h2>
                            <p className="opacity-90 mb-8 text-indigo-100 text-lg max-w-lg">You have <span className="font-bold text-white bg-white/20 px-3 py-1 rounded-lg backdrop-blur-sm">{dueCount} cards</span> waiting for review.</p>
                            <div className="flex flex-wrap gap-4">
                                <button onClick={() => setShowReviewModal(true)} disabled={dueCount === 0} className={`flex items-center gap-2 px-8 py-4 rounded-2xl font-bold transition-all shadow-lg transform active:scale-95 ${dueCount > 0 ? 'bg-white text-indigo-600 hover:bg-indigo-50 cursor-pointer' : 'bg-black/20 text-white/50 cursor-not-allowed'}`}><Repeat className="w-5 h-5" /> {dueCount > 0 ? 'Start Review Session' : 'All Caught Up!'}</button>
                                <button onClick={() => setShowFlashcardModal(true)} className="flex items-center gap-2 px-8 py-4 rounded-2xl font-bold bg-white/10 text-white hover:bg-white/20 border border-white/20 transition-all shadow-lg backdrop-blur-sm"><Layers className="w-5 h-5" /> Flashcards</button>
                                {items.length === 0 && (
                                <button onClick={onLoadDemo} disabled={isAdding} className="flex items-center gap-2 px-6 py-4 rounded-2xl font-bold bg-indigo-500/30 text-white hover:bg-indigo-500/40 border border-white/20 transition-all disabled:opacity-50">{isAdding ? <Loader2 className="w-5 h-5 animate-spin"/> : <Sparkles className="w-5 h-5" />} Load Example Data</button>
                                )}
                            </div>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className={`${cardBg} p-6 rounded-[2rem] flex items-center gap-5 shadow-lg`}>
                            <div className="bg-blue-500/10 p-4 rounded-2xl"><Layers className="w-8 h-8 text-blue-500" /></div>
                            <div><div className={`text-4xl font-black ${textColor}`}>{stats.total}</div><div className={`text-sm font-bold uppercase tracking-wider ${subText}`}>Total Items</div></div>
                        </div>
                        <div className={`${cardBg} p-6 rounded-[2rem] flex items-center gap-5 shadow-lg`}>
                            <div className="bg-green-500/10 p-4 rounded-2xl"><Check className="w-8 h-8 text-green-500" /></div>
                            <div><div className={`text-4xl font-black ${textColor}`}>{stats.mastered}</div><div className={`text-sm font-bold uppercase tracking-wider ${subText}`}>Mastered</div></div>
                        </div>
                        <div className={`${cardBg} p-6 rounded-[2rem] flex items-center gap-5 shadow-lg`}>
                            <div className="bg-amber-500/10 p-4 rounded-2xl"><Zap className="w-8 h-8 text-amber-500" /></div>
                            <div><div className={`text-4xl font-black ${textColor}`}>{stats.learning}</div><div className={`text-sm font-bold uppercase tracking-wider ${subText}`}>Learning</div></div>
                        </div>
                    </div>
                    
                    <div className={`${cardBg} p-8 rounded-[2.5rem] shadow-xl border ${theme==='dark'?'border-white/5':'border-white/50'}`}>
                        <div className="flex items-center justify-between mb-8"><h3 className={`font-bold text-2xl ${textColor} flex items-center gap-3`}><Clock className="w-6 h-6 text-indigo-500" /> Recently Added</h3><span className={`text-xs font-bold ${subText} uppercase tracking-widest`}>Status</span></div>
                        <div className="space-y-4">
                        {items.slice(0, 5).map(item => (
                            <div key={item.id} className={`group flex items-center justify-between p-5 rounded-2xl border border-transparent transition-all cursor-default ${theme==='dark'?'hover:bg-white/5 hover:border-white/10':'hover:bg-slate-50 hover:border-slate-200'}`}>
                            <div className="flex items-center gap-5">
                                <div className={`w-2 h-12 rounded-full ${item.type === 'synonym' ? 'bg-indigo-400' : item.type === 'antonym' ? 'bg-rose-400' : item.type === 'voca' ? 'bg-indigo-400' : 'bg-indigo-400'}`}></div>
                                <div>
                                <div className={`font-bold text-lg ${textColor}`}>{item.mainText}</div>
                                <div className={`text-xs font-bold uppercase tracking-wide flex gap-2 ${subText}`}>{item.type} {item.context && <span className="text-indigo-500">â€¢ {item.context}</span>}</div>
                                </div>
                            </div>
                            <div className="text-right"><div className={`text-sm font-bold ${item.nextReview < Date.now() ? 'text-rose-500' : 'text-emerald-500'}`}>{getRelativeTime(item.nextReview)}</div><div className={`text-xs font-bold ${subText}`}>Next Review</div></div>
                            </div>
                        ))}
                        {items.length === 0 && (<div className={`text-center py-12 rounded-3xl border border-dashed ${theme==='dark'?'border-slate-700 text-slate-500':'border-slate-200 text-slate-400'}`}><p>Your mind palace is empty.</p><p className="text-sm mt-2">Add items or click "Load Example Data" above.</p></div>)}
                        </div>
                    </div>
                </div>
            );
        };

        const VocaManager = ({ items, onAdd, onDelete, onDeleteAll, onUpdate, theme }) => {
            const [formData, setFormData] = useState({ word: '', pos: 'noun', ipa: '', definition: '', example: '', collocations: '' });
            const [isFetchingIPA, setIsFetchingIPA] = useState(false);
            const [isFetchingExample, setIsFetchingExample] = useState(false);
            const [isFetchingCollo, setIsFetchingCollo] = useState(false);
            const [isUploading, setIsUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0 });
            const [editingItem, setEditingItem] = useState(null);
            const [editFormData, setEditFormData] = useState({ word: '', pos: 'noun', ipa: '', definition: '', example: '', collocations: '' });
            const fileInputRef = useRef(null);
            
            const openEditModal = (item) => {
                setEditingItem(item);
                setEditFormData({
                    word: item.mainText || '',
                    pos: item.pos || 'noun',
                    ipa: item.ipa || '',
                    definition: item.context || '',
                    example: item.example || '',
                    collocations: item.collocations || ''
                });
            };
            
            const handleEditChange = (e) => { const { name, value } = e.target; setEditFormData(prev => ({ ...prev, [name]: value })); };
            
            const handleEditSubmit = (e) => {
                e.preventDefault();
                if (!editFormData.word.trim() || !editingItem) return;
                onUpdate(editingItem.id, {
                    mainText: editFormData.word,
                    context: editFormData.definition,
                    pos: editFormData.pos,
                    ipa: editFormData.ipa,
                    example: editFormData.example,
                    collocations: editFormData.collocations
                });
                setEditingItem(null);
            };
            
            const generateWordDataWithAI = async (word) => {
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `Analyze the English word "${word}" and provide the following information in JSON format only (no markdown, no code blocks, just raw JSON):
{
  "pos": "part of speech (noun, verb, adjective, adverb, or idiom)",
  "ipa": "IPA pronunciation notation",
  "definition": "clear and concise definition (1-2 sentences)",
  "example": "example sentence using the word",
  "collocations": "3-5 common word pairings separated by commas"
}
Respond with ONLY the JSON object, nothing else.`
                                }]
                            }]
                        })
                    });
                    const data = await response.json();
                    const text = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                    const cleanJson = text.replace(/```json\n?|```\n?/g, '').trim();
                    return JSON.parse(cleanJson);
                } catch (error) {
                    console.error('AI word analysis failed:', error);
                    return { pos: 'noun', ipa: '', definition: 'Definition not available', example: '', collocations: '' };
                }
            };
            
            const generateIPAWithAI = async (word) => {
                // First try the free dictionary API
                try {
                    const dictResponse = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${encodeURIComponent(word)}`);
                    if (dictResponse.ok) {
                        const dictData = await dictResponse.json();
                        if (Array.isArray(dictData) && dictData.length > 0) {
                            const entry = dictData[0];
                            let foundIPA = entry.phonetic;
                            if (!foundIPA && entry.phonetics?.length > 0) {
                                foundIPA = entry.phonetics.find(p => p.text)?.text;
                            }
                            if (foundIPA) return foundIPA;
                        }
                    }
                } catch (dictError) {
                    console.log('Dictionary API failed, trying AI:', dictError);
                }
                
                // Fallback to AI for IPA generation
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `Give me ONLY the IPA phonetic transcription for the English word "${word}". Return ONLY the IPA symbols inside slashes like /stÊŒnt/. No explanation, no other text.`
                                }]
                            }]
                        })
                    });
                    const data = await response.json();
                    const ipaText = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim() || '';
                    // Clean up any extra text, keep only the IPA in slashes
                    const ipaMatch = ipaText.match(/\/[^\/]+\//);
                    return ipaMatch ? ipaMatch[0] : ipaText;
                } catch (error) {
                    console.error('AI IPA generation failed:', error);
                    return '';
                }
            };

            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsUploading(true);
                
                try {
                    const content = await file.text();
                    // Split by blank lines to separate word entries
                    const entries = content.split(/\n\s*\n/).map(entry => entry.trim()).filter(entry => entry !== '');
                    setUploadProgress({ current: 0, total: entries.length });
                    
                    for (let i = 0; i < entries.length; i++) {
                        const entry = entries[i];
                        const lines = entry.split(/[\n\r]+/).map(line => line.trim()).filter(line => line !== '');
                        
                        if (lines.length >= 1) {
                            // Parse first line: "word [pos]"
                            const firstLineMatch = lines[0].match(/^(.+?)\s*\[(.+?)\]\s*$/);
                            if (firstLineMatch) {
                                const word = firstLineMatch[1].trim();
                                const pos = firstLineMatch[2].trim().toLowerCase();
                                
                                // Parse Definition line
                                let definition = '';
                                const defLine = lines.find(l => l.toLowerCase().startsWith('definition:'));
                                if (defLine) {
                                    definition = defLine.replace(/^definition:\s*/i, '').trim();
                                }
                                
                                // Parse Sentence line
                                let example = '';
                                const sentLine = lines.find(l => l.toLowerCase().startsWith('sentence:'));
                                if (sentLine) {
                                    example = sentLine.replace(/^sentence:\s*/i, '').trim();
                                }
                                
                                // Generate IPA pronunciation using AI
                                const ipa = await generateIPAWithAI(word);
                                
                                onAdd({
                                    type: 'voca',
                                    mainText: word,
                                    context: definition,
                                    pos: pos,
                                    ipa: ipa,
                                    example: example,
                                    collocations: '',
                                    easiness: 2.5,
                                    interval: 0,
                                    nextReview: Date.now()
                                });
                            }
                        }
                        setUploadProgress({ current: i + 1, total: entries.length });
                    }
                } catch (error) {
                    console.error('File parsing error:', error);
                }
                
                setIsUploading(false);
                setUploadProgress({ current: 0, total: 0 });
                e.target.value = '';
            };

            const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
            const handleSubmit = (e) => { e.preventDefault(); if (!formData.word.trim()) return; onAdd({ type: 'voca', mainText: formData.word, context: formData.definition, pos: formData.pos, ipa: formData.ipa, example: formData.example, collocations: formData.collocations, easiness: 2.5, interval: 0, nextReview: Date.now() }); setFormData({ word: '', pos: 'noun', ipa: '', definition: '', example: '', collocations: '' }); };
            
            // AI Handlers
            const handleAutoData = async (fieldToUpdate) => {
                if (!formData.word) return;
                if (fieldToUpdate === 'ipa') setIsFetchingIPA(true);
                if (fieldToUpdate === 'example') setIsFetchingExample(true);
                try {
                    const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${formData.word}`);
                    const data = await res.json();
                    if (Array.isArray(data) && data.length > 0) {
                        const entry = data[0];
                        if (fieldToUpdate === 'ipa') {
                            let foundIPA = entry.phonetic;
                            if (!foundIPA && entry.phonetics?.length > 0) foundIPA = entry.phonetics.find(p => p.text)?.text;
                            if (foundIPA) setFormData(prev => ({ ...prev, ipa: foundIPA }));
                            if (!formData.definition && entry.meanings?.[0]?.definitions?.[0]?.definition) {
                                setFormData(prev => ({ ...prev, definition: entry.meanings[0].definitions[0].definition }));
                            }
                        }
                        if (fieldToUpdate === 'example') {
                            let foundExample = '';
                            for (const meaning of entry.meanings) {
                                for (const def of meaning.definitions) {
                                    if (def.example) { foundExample = def.example; break; }
                                }
                                if (foundExample) break;
                            }
                            if (foundExample) setFormData(prev => ({ ...prev, example: foundExample }));
                        }
                    }
                } catch (e) { console.error(e); }
                setIsFetchingIPA(false);
                setIsFetchingExample(false);
            };

            const handleAutoCollocations = async () => {
                if (!formData.word) return;
                setIsFetchingCollo(true);
                try {
                    const res = await fetch(`https://api.datamuse.com/words?rel_jja=${formData.word}&max=5`);
                    let data = await res.json();
                    if (data.length === 0) {
                        const res2 = await fetch(`https://api.datamuse.com/words?rel_trg=${formData.word}&max=5`);
                        data = await res2.json();
                    }
                    if (data.length > 0) {
                        const words = data.map(item => item.word).join(', ');
                        setFormData(prev => ({ ...prev, collocations: words }));
                    }
                } catch (e) { console.error(e); }
                setIsFetchingCollo(false);
            };

            const vocaItems = items.filter(i => i.type === 'voca');
            const inputClass = theme === 'dark' 
                ? 'bg-slate-950/50 border border-slate-700 text-slate-100 placeholder:text-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-inner backdrop-blur-sm' 
                : 'bg-white border border-slate-200 text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-sm';
            
            const labelClass = theme === 'dark' ? 'text-slate-400 font-bold' : 'text-slate-500 font-bold';

            return (
                <div className="space-y-12 animate-in slide-in-from-right-4 duration-500 pt-24 pb-12 max-w-6xl mx-auto px-4">
                    <ManagerContainer title="New Entry" subtitle="Add a new word to your collection." theme={theme}>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="md:col-span-2 space-y-2">
                                    <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Word</label>
                                    <div className="relative"><input name="word" value={formData.word} onChange={handleChange} placeholder="e.g. Serendipity" className={`w-full p-4 rounded-2xl outline-none font-bold transition-all pr-12 ${inputClass}`} /><Volume2 className="absolute right-4 top-4 w-5 h-5 text-indigo-500 opacity-50"/></div>
                                </div>
                                <div className="space-y-2">
                                    <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Type</label>
                                    <select name="pos" value={formData.pos} onChange={handleChange} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all appearance-none cursor-pointer ${inputClass}`}><option value="noun">Noun</option><option value="verb">Verb</option><option value="adjective">Adjective</option><option value="adverb">Adverb</option><option value="idiom">Idiom</option></select>
                                </div>
                            </div>
                            
                            {/* Row 2: IPA and Collocations */}
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="space-y-2">
                                    <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>IPA (Pronunciation)</label>
                                    <div className="relative">
                                        <input name="ipa" value={formData.ipa} onChange={handleChange} placeholder="/.../" className={`w-full p-4 rounded-2xl outline-none font-mono text-sm transition-all pr-12 ${inputClass}`} />
                                        <button type="button" onClick={() => handleAutoData('ipa')} disabled={isFetchingIPA} className="absolute right-2 top-2 p-2 bg-indigo-500/10 text-indigo-500 rounded-xl hover:bg-indigo-500/20 transition-colors" title="Auto-Detect IPA">
                                            {isFetchingIPA ? <Loader2 className="w-4 h-4 animate-spin"/> : <Wand2 className="w-4 h-4" />}
                                        </button>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Collocations</label>
                                    <div className="relative">
                                        <input name="collocations" value={formData.collocations} onChange={handleChange} placeholder="strong coffee, heavy rain..." className={`w-full p-4 rounded-2xl outline-none font-medium transition-all pr-12 ${inputClass}`} />
                                        <button type="button" onClick={handleAutoCollocations} disabled={isFetchingCollo} className="absolute right-2 top-2 p-2 bg-indigo-500/10 text-indigo-500 rounded-xl hover:bg-indigo-500/20 transition-colors" title="Find Collocations">
                                            {isFetchingCollo ? <Loader2 className="w-4 h-4 animate-spin"/> : <Wand2 className="w-4 h-4" />}
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div className="space-y-2"><label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Definition</label><textarea name="definition" value={formData.definition} onChange={handleChange} rows="2" placeholder="What does it mean?" className={`w-full p-4 rounded-2xl outline-none font-medium resize-none transition-all ${inputClass}`} /></div>
                            
                            {/* Row 4: Example Sentence */}
                            <div className="space-y-2">
                                <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Example Sentence</label>
                                <div className="relative">
                                    <textarea name="example" value={formData.example} onChange={handleChange} rows="2" placeholder="Use it in a sentence..." className={`w-full p-4 rounded-2xl outline-none font-medium resize-none transition-all pr-12 ${inputClass}`} />
                                    <button type="button" onClick={() => handleAutoData('example')} disabled={isFetchingExample} className="absolute right-3 top-3 p-2 bg-indigo-500/10 text-indigo-500 rounded-xl hover:bg-indigo-500/20 transition-colors" title="Generate Example">
                                        {isFetchingExample ? <Loader2 className="w-4 h-4 animate-spin"/> : <Wand2 className="w-4 h-4" />}
                                    </button>
                                </div>
                            </div>

                            <div className="flex justify-end"><button type="submit" className="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold hover:bg-slate-800 transition-all shadow-lg hover:shadow-xl active:scale-95 flex items-center gap-2"><Plus className="w-5 h-5" /> Add Card</button></div>
                        </form>
                    </ManagerContainer>
                    <ManagerContainer title="Vocabulary" subtitle={`${vocaItems.length} items`} theme={theme} headerAction={
                        <div className="flex items-center gap-2">
                            <input type="file" accept=".txt" ref={fileInputRef} onChange={handleFileUpload} className="hidden" disabled={isUploading} />
                            {isUploading ? (
                                <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400' : 'bg-indigo-100 text-indigo-600'}`}>
                                    <Loader2 className="w-4 h-4 animate-spin" />
                                    <span className="text-xs font-bold">{uploadProgress.current}/{uploadProgress.total}</span>
                                </div>
                            ) : (
                                <>
                                    <button onClick={() => fileInputRef.current?.click()} title="Upload words from TXT file" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400 hover:bg-indigo-500/30' : 'bg-indigo-100 text-indigo-600 hover:bg-indigo-200'}`}>
                                        <Upload className="w-5 h-5" />
                                    </button>
                                    {vocaItems.length > 0 && (
                                        <button onClick={() => onDeleteAll('voca')} title="Delete all vocabulary items" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}>
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    }>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-5">
                            {vocaItems.map(item => (<ItemCard key={item.id} type="voca" title={item.mainText} theme={theme} subtitle={<span><span className="font-bold text-indigo-500 uppercase text-[10px] tracking-wider mr-2 bg-indigo-500/10 px-1.5 py-0.5 rounded">{item.pos}</span>{item.context || "No definition"}</span>} icon={Book} onDelete={() => onDelete(item.id)} onEdit={() => openEditModal(item)} interval={item.interval} />))}
                        </div>
                    </ManagerContainer>
                    
                    {/* Edit Modal for Vocabulary */}
                    {editingItem && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4" onClick={() => setEditingItem(null)}>
                            <div className={`${theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} p-8 rounded-3xl max-w-2xl w-full shadow-2xl border animate-in zoom-in-95 max-h-[90vh] overflow-y-auto`} onClick={e => e.stopPropagation()}>
                                <h3 className={`text-2xl font-black mb-6 ${theme === 'dark' ? 'text-white' : 'text-slate-800'}`}>Edit Vocabulary</h3>
                                <form onSubmit={handleEditSubmit} className="space-y-5">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Word</label>
                                            <input name="word" value={editFormData.word} onChange={handleEditChange} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Type</label>
                                            <select name="pos" value={editFormData.pos} onChange={handleEditChange} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all appearance-none cursor-pointer ${inputClass}`}>
                                                <option value="noun">Noun</option><option value="verb">Verb</option><option value="adjective">Adjective</option><option value="adverb">Adverb</option><option value="idiom">Idiom</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>IPA (Pronunciation)</label>
                                            <input name="ipa" value={editFormData.ipa} onChange={handleEditChange} className={`w-full p-4 rounded-2xl outline-none font-mono text-sm transition-all ${inputClass}`} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Collocations</label>
                                            <input name="collocations" value={editFormData.collocations} onChange={handleEditChange} className={`w-full p-4 rounded-2xl outline-none font-medium transition-all ${inputClass}`} />
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Definition</label>
                                        <textarea name="definition" value={editFormData.definition} onChange={handleEditChange} rows="2" className={`w-full p-4 rounded-2xl outline-none font-medium resize-none transition-all ${inputClass}`} />
                                    </div>
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Example Sentence</label>
                                        <textarea name="example" value={editFormData.example} onChange={handleEditChange} rows="2" className={`w-full p-4 rounded-2xl outline-none font-medium resize-none transition-all ${inputClass}`} />
                                    </div>
                                    <div className="flex justify-end gap-3 pt-2">
                                        <button type="button" onClick={() => setEditingItem(null)} className={`px-6 py-3 rounded-xl font-bold transition-all ${theme === 'dark' ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Cancel</button>
                                        <button type="submit" className="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all flex items-center gap-2"><Save className="w-4 h-4" /> Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const SynonymManager = ({ items, onAdd, onDelete, onDeleteAll, onUpdate, theme }) => {
            const [word, setWord] = useState('');
            const [synonyms, setSynonyms] = useState('');
            const [isUploading, setIsUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0 });
            const [editingItem, setEditingItem] = useState(null);
            const [editWord, setEditWord] = useState('');
            const [editSynonyms, setEditSynonyms] = useState('');
            const fileInputRef = useRef(null);
            
            const openEditModal = (item) => {
                setEditingItem(item);
                setEditWord(item.mainText || '');
                setEditSynonyms(item.related?.join(', ') || '');
            };
            
            const handleEditSubmit = (e) => {
                e.preventDefault();
                if (!editWord.trim() || !editingItem) return;
                const synList = editSynonyms.split(',').map(s => s.trim()).filter(s => s);
                onUpdate(editingItem.id, { mainText: editWord, related: synList });
                setEditingItem(null);
            };
            
            const generateSynonymsWithAI = async (wordText) => {
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `For the word "${wordText}", provide 4-6 synonyms. Respond with ONLY the synonyms separated by commas, nothing else. Example: joyful, cheerful, elated, content, pleased`
                                }]
                            }]
                        })
                    });
                    const data = await response.json();
                    const generatedSynonyms = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                    return generatedSynonyms ? generatedSynonyms.split(',').map(s => s.trim()).filter(s => s) : [];
                } catch (error) {
                    console.error('AI synonym generation failed:', error);
                    return [];
                }
            };
            
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsUploading(true);
                
                try {
                    const content = await file.text();
                    const lines = content.split(/[\n\r]+/).map(line => line.trim()).filter(line => line !== '' && line.length < 100);
                    setUploadProgress({ current: 0, total: lines.length });
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line) {
                            // Parse format: "word (synonym)" or "word (syn1, syn2, syn3)"
                            const match = line.match(/^(.+?)\s*\((.+?)\)\s*$/);
                            if (match) {
                                const mainWord = match[1].trim();
                                const synList = match[2].split(',').map(s => s.trim()).filter(s => s);
                                onAdd({ type: 'synonym', mainText: mainWord, related: synList, easiness: 2.5, interval: 0, nextReview: Date.now() });
                            }
                        }
                        setUploadProgress({ current: i + 1, total: lines.length });
                    }
                } catch (error) {
                    console.error('File parsing error:', error);
                }
                
                setIsUploading(false);
                setUploadProgress({ current: 0, total: 0 });
                e.target.value = '';
            };
            
            const handleSubmit = (e) => { e.preventDefault(); if (!word.trim()) return; const synList = synonyms.split(',').map(s => s.trim()).filter(s => s); onAdd({ type: 'synonym', mainText: word, related: synList, easiness: 2.5, interval: 0, nextReview: Date.now() }); setWord(''); setSynonyms(''); };
            const synonymItems = items.filter(i => i.type === 'synonym');
            
            const inputClass = theme === 'dark' 
                ? 'bg-slate-950/50 border border-slate-700 text-slate-100 placeholder:text-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-inner backdrop-blur-sm' 
                : 'bg-white border border-slate-200 text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-sm';
            
            const labelClass = theme === 'dark' ? 'text-slate-400 font-bold' : 'text-slate-500 font-bold';

            // Synonym Card Component
            const SynonymCard = ({ item }) => (
                <div className={`${theme==='dark'?'bg-slate-900/50 border-slate-700':'bg-white border-slate-100'} rounded-3xl p-5 shadow-sm border hover:shadow-md transition-all duration-300 relative group overflow-hidden`}>
                    <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-violet-400 via-indigo-500 to-violet-400"></div>
                    <div className="flex items-center justify-between gap-3 mt-3 mb-2">
                        <div className="flex-1 text-center min-w-0"><div className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">Concept</div><h4 className={`text-xl font-black truncate ${theme==='dark'?'text-white':'text-slate-800'}`}>{item.mainText}</h4></div>
                        <div className="shrink-0 flex flex-col items-center pt-4"><div className={`w-8 h-8 rounded-full border flex items-center justify-center shadow-inner ${theme==='dark'?'bg-slate-800 border-slate-600 text-indigo-400':'bg-indigo-50 border-indigo-100 text-indigo-600'}`}><LinkIcon className="w-3.5 h-3.5" /></div></div>
                        <div className="flex-1 text-center min-w-0"><div className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest mb-1">Synonyms</div><div className={`text-xl font-black truncate ${theme==='dark'?'text-slate-300':'text-slate-800'}`}>{item.related?.[0] || '...'}{item.related?.length > 1 && <span className="text-indigo-500 text-xs ml-1 align-top">+{item.related.length - 1}</span>}</div></div>
                    </div>
                    <div className={`flex justify-end gap-2 mt-2 pt-2 border-t ${theme==='dark'?'border-slate-800':'border-slate-50'}`}>
                        <button onClick={() => openEditModal(item)} className="text-slate-400 hover:text-indigo-500 transition-colors p-1.5"><Pencil className="w-4 h-4" /></button>
                        <button onClick={() => onDelete(item.id)} className="text-slate-400 hover:text-indigo-500 transition-colors p-1.5"><Trash2 className="w-4 h-4" /></button>
                    </div>
                </div>
            );

            return (
                <div className="space-y-12 animate-in slide-in-from-right-4 duration-500 pt-24 pb-12 max-w-6xl mx-auto px-4">
                    {/* Edit Modal */}
                    {editingItem && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4" onClick={() => setEditingItem(null)}>
                            <div className={`${theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} p-8 rounded-3xl max-w-lg w-full shadow-2xl border animate-in zoom-in-95`} onClick={e => e.stopPropagation()}>
                                <h3 className={`text-2xl font-black mb-6 ${theme === 'dark' ? 'text-white' : 'text-slate-800'}`}>Edit Synonym Chain</h3>
                                <form onSubmit={handleEditSubmit} className="space-y-6">
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Main Word</label>
                                        <input value={editWord} onChange={e => setEditWord(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                    </div>
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Synonyms (comma-separated)</label>
                                        <input value={editSynonyms} onChange={e => setEditSynonyms(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                    </div>
                                    <div className="flex justify-end gap-3">
                                        <button type="button" onClick={() => setEditingItem(null)} className={`px-6 py-3 rounded-xl font-bold transition-all ${theme === 'dark' ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Cancel</button>
                                        <button type="submit" className="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all flex items-center gap-2"><Save className="w-4 h-4" /> Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    
                    <ManagerContainer title="New Chain" subtitle="Link concepts together." theme={theme}>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="space-y-2"><label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Main Word</label><input value={word} onChange={e => setWord(e.target.value)} placeholder="e.g. Happy" className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} /></div>
                                <div className="space-y-2"><label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Synonyms</label><input value={synonyms} onChange={e => setSynonyms(e.target.value)} placeholder="Joyful, Ecstatic..." className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} /></div>
                            </div>
                            <div className="flex justify-end"><button type="submit" className="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold hover:bg-slate-800 transition-all shadow-lg active:scale-95 flex items-center gap-2"><LinkIcon className="w-5 h-5" /> Connect</button></div>
                        </form>
                    </ManagerContainer>
                    <ManagerContainer title="Synonyms" subtitle={`${synonymItems.length} chains`} theme={theme} headerAction={
                        <div className="flex items-center gap-2">
                            <input type="file" accept=".txt" ref={fileInputRef} onChange={handleFileUpload} className="hidden" disabled={isUploading} />
                            {isUploading ? (
                                <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${theme === 'dark' ? 'bg-violet-500/20 text-violet-400' : 'bg-violet-100 text-violet-600'}`}>
                                    <Loader2 className="w-4 h-4 animate-spin" />
                                    <span className="text-xs font-bold">{uploadProgress.current}/{uploadProgress.total}</span>
                                </div>
                            ) : (
                                <>
                                    <button onClick={() => fileInputRef.current?.click()} title="Upload words from TXT file" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-violet-500/20 text-violet-400 hover:bg-violet-500/30' : 'bg-violet-100 text-violet-600 hover:bg-violet-200'}`}>
                                        <Upload className="w-5 h-5" />
                                    </button>
                                    {synonymItems.length > 0 && (
                                        <button onClick={() => onDeleteAll('synonym')} title="Delete all synonym chains" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}>
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    }>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{synonymItems.map(item => (<SynonymCard key={item.id} item={item} />))}</div>
                    </ManagerContainer>
                </div>
            );
        };

        const AntonymManager = ({ items, onAdd, onDelete, onDeleteAll, onUpdate, theme }) => {
            const [wordA, setWordA] = useState('');
            const [wordB, setWordB] = useState('');
            const [isUploading, setIsUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0 });
            const [editingItem, setEditingItem] = useState(null);
            const [editWordA, setEditWordA] = useState('');
            const [editWordB, setEditWordB] = useState('');
            const fileInputRef = useRef(null);
            
            const openEditModal = (item) => {
                setEditingItem(item);
                setEditWordA(item.mainText || '');
                setEditWordB(item.related?.[0] || '');
            };
            
            const handleEditSubmit = (e) => {
                e.preventDefault();
                if (!editWordA.trim() || !editWordB.trim() || !editingItem) return;
                onUpdate(editingItem.id, { mainText: editWordA, related: [editWordB] });
                setEditingItem(null);
            };
            
            const generateAntonymWithAI = async (wordText) => {
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `For the word "${wordText}", provide its most common antonym (opposite word). Respond with ONLY the single antonym word, nothing else.`
                                }]
                            }]
                        })
                    });
                    const data = await response.json();
                    const antonym = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                    return antonym || '';
                } catch (error) {
                    console.error('AI antonym generation failed:', error);
                    return '';
                }
            };
            
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsUploading(true);
                try {
                    const content = await file.text();
                    const lines = content.split(/[\n\r]+/).map(line => line.trim()).filter(line => line !== '' && line.length < 100);
                    setUploadProgress({ current: 0, total: lines.length });
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (line) {
                            // Parse format: "word (antonym)"
                            const match = line.match(/^(.+?)\s*\((.+?)\)\s*$/);
                            if (match) {
                                const mainWord = match[1].trim();
                                const antonym = match[2].trim();
                                onAdd({ type: 'antonym', mainText: mainWord, related: [antonym], easiness: 2.5, interval: 0, nextReview: Date.now() });
                            }
                        }
                        setUploadProgress({ current: i + 1, total: lines.length });
                    }
                } catch (error) {
                    console.error('File parsing error:', error);
                }
                setIsUploading(false);
                setUploadProgress({ current: 0, total: 0 });
                e.target.value = '';
            };
            
            const handleSubmit = (e) => { e.preventDefault(); if (!wordA.trim() || !wordB.trim()) return; onAdd({ type: 'antonym', mainText: wordA, related: [wordB], easiness: 2.5, interval: 0, nextReview: Date.now() }); setWordA(''); setWordB(''); };
            const antonymItems = items.filter(i => i.type === 'antonym');
            
            const inputClass = theme === 'dark' 
                ? 'bg-slate-950/50 border border-slate-700 text-slate-100 placeholder:text-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-inner backdrop-blur-sm' 
                : 'bg-white border border-slate-200 text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-sm';
            
            const labelClass = theme === 'dark' ? 'text-slate-400 font-bold' : 'text-slate-500 font-bold';

            const AntonymCard = ({ item }) => (
                <div className={`${theme==='dark'?'bg-slate-900/50 border-slate-700':'bg-white border-slate-100'} rounded-3xl p-6 shadow-sm border hover:shadow-md transition-all duration-300 relative group overflow-hidden`}>
                    <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-rose-400 via-pink-500 to-rose-400"></div>
                    <div className="flex items-center justify-between gap-2 mt-2">
                        <div className="flex-1 text-center min-w-0"><div className="text-[10px] font-bold text-rose-400 uppercase tracking-widest mb-1">Positive</div><h4 className={`text-xl font-black truncate ${theme==='dark'?'text-white':'text-slate-800'}`}>{item.mainText}</h4></div>
                        <div className="shrink-0 flex flex-col items-center"><div className={`w-10 h-10 rounded-full border flex items-center justify-center text-xs font-black shadow-inner ${theme==='dark'?'bg-slate-800 border-slate-600 text-rose-400':'bg-rose-50 border-rose-100 text-rose-600'}`}>VS</div></div>
                        <div className="flex-1 text-center min-w-0"><div className="text-[10px] font-bold text-rose-400 uppercase tracking-widest mb-1">Negative</div><h4 className={`text-xl font-black truncate ${theme==='dark'?'text-white':'text-slate-800'}`}>{item.related?.[0] || '?'}</h4></div>
                    </div>
                    <div className={`flex justify-end gap-2 items-end mt-6 pt-4 border-t ${theme==='dark'?'border-slate-800':'border-slate-50'}`}>
                        <button onClick={() => openEditModal(item)} className="text-slate-400 hover:text-rose-500 transition-colors p-1"><Pencil className="w-4 h-4" /></button>
                        <button onClick={() => onDelete(item.id)} className="text-slate-400 hover:text-rose-500 transition-colors p-1"><Trash2 className="w-4 h-4" /></button>
                    </div>
                </div>
            );

            return (
                <div className="space-y-12 animate-in slide-in-from-right-4 duration-500 pt-24 pb-12 max-w-6xl mx-auto px-4">
                    {/* Edit Modal */}
                    {editingItem && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4" onClick={() => setEditingItem(null)}>
                            <div className={`${theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} p-8 rounded-3xl max-w-lg w-full shadow-2xl border animate-in zoom-in-95`} onClick={e => e.stopPropagation()}>
                                <h3 className={`text-2xl font-black mb-6 ${theme === 'dark' ? 'text-white' : 'text-slate-800'}`}>Edit Antonym Pair</h3>
                                <form onSubmit={handleEditSubmit} className="space-y-6">
                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Word</label>
                                            <input value={editWordA} onChange={e => setEditWordA(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Antonym</label>
                                            <input value={editWordB} onChange={e => setEditWordB(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                        </div>
                                    </div>
                                    <div className="flex justify-end gap-3">
                                        <button type="button" onClick={() => setEditingItem(null)} className={`px-6 py-3 rounded-xl font-bold transition-all ${theme === 'dark' ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Cancel</button>
                                        <button type="submit" className="bg-rose-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-rose-700 transition-all flex items-center gap-2"><Save className="w-4 h-4" /> Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    
                    <ManagerContainer title="New Contrast" subtitle="Define opposites & master the spectrum." theme={theme}>
                        <form onSubmit={handleSubmit} className="space-y-8">
                            <div className="flex flex-col md:flex-row items-center gap-4 relative">
                                <div className="space-y-2 flex-1 w-full"><input value={wordA} onChange={e => setWordA(e.target.value)} placeholder="e.g. Expand" className={`w-full p-5 rounded-2xl outline-none font-bold text-lg transition-all ${inputClass}`} /></div>
                                <div className="hidden md:flex shrink-0 justify-center"><div className={`font-black text-xl italic w-10 h-10 rounded-full flex items-center justify-center shadow-sm ${theme==='dark'?'bg-slate-700 text-slate-400':'bg-white text-slate-200'}`}>vs</div></div>
                                <div className="space-y-2 flex-1 w-full"><input value={wordB} onChange={e => setWordB(e.target.value)} placeholder="e.g. Contract" className={`w-full p-5 rounded-2xl outline-none font-bold text-lg transition-all ${inputClass}`} /></div>
                            </div>
                            <div className="flex justify-end"><button type="submit" className="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold hover:bg-slate-800 transition-all shadow-lg active:scale-95 flex items-center gap-2"><ArrowLeftRight className="w-5 h-5" /> Create Pair</button></div>
                        </form>
                    </ManagerContainer>
                    <ManagerContainer title="Antonyms" subtitle={`${antonymItems.length} pairs`} theme={theme} headerAction={
                        <div className="flex items-center gap-2">
                            <input type="file" accept=".txt" ref={fileInputRef} onChange={handleFileUpload} className="hidden" disabled={isUploading} />
                            {isUploading ? (
                                <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${theme === 'dark' ? 'bg-rose-500/20 text-rose-400' : 'bg-rose-100 text-rose-600'}`}>
                                    <Loader2 className="w-4 h-4 animate-spin" />
                                    <span className="text-xs font-bold">{uploadProgress.current}/{uploadProgress.total}</span>
                                </div>
                            ) : (
                                <>
                                    <button onClick={() => fileInputRef.current?.click()} title="Upload words from TXT file" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-rose-500/20 text-rose-400 hover:bg-rose-500/30' : 'bg-rose-100 text-rose-600 hover:bg-rose-200'}`}>
                                        <Upload className="w-5 h-5" />
                                    </button>
                                    {antonymItems.length > 0 && (
                                        <button onClick={() => onDeleteAll('antonym')} title="Delete all antonym pairs" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}>
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    }>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">{antonymItems.map(item => (<AntonymCard key={item.id} item={item} />))}</div>
                    </ManagerContainer>
                </div>
            );
        };

        const PhraseManager = ({ items, onAdd, onDelete, onDeleteAll, onUpdate, theme }) => {
            const [phrase, setPhrase] = useState('');
            const [context, setContext] = useState('');
            const [isUploading, setIsUploading] = useState(false);
            const [uploadProgress, setUploadProgress] = useState({ current: 0, total: 0 });
            const [editingItem, setEditingItem] = useState(null);
            const [editPhrase, setEditPhrase] = useState('');
            const [editContext, setEditContext] = useState('');
            const fileInputRef = useRef(null);
            
            const openEditModal = (item) => {
                setEditingItem(item);
                setEditPhrase(item.mainText);
                setEditContext(item.context || '');
            };
            
            const handleEditSubmit = (e) => {
                e.preventDefault();
                if (!editPhrase.trim() || !editingItem) return;
                onUpdate(editingItem.id, { mainText: editPhrase, context: editContext });
                setEditingItem(null);
                setEditPhrase('');
                setEditContext('');
            };
            const handleSubmit = (e) => { e.preventDefault(); if (!phrase.trim()) return; onAdd({ type: 'phrase', mainText: phrase, context: context, easiness: 2.5, interval: 0, nextReview: Date.now() }); setPhrase(''); setContext(''); };
            const phraseItems = items.filter(i => i.type === 'phrase');
            
            const generateContextWithAI = async (phraseText) => {
                try {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyDHD8AhAFmlH9Cr06dBGTS9Lpvqvs9jNtM', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `For the phrase "${phraseText}", provide a very brief contextual usage description (2-4 words max) that explains when or why someone would use this phrase. Examples: "Wishing luck", "Expressing gratitude", "Showing surprise", "Giving advice". Respond with ONLY the brief context, nothing else.`
                                }]
                            }]
                        })
                    });
                    const data = await response.json();
                    const generatedContext = data?.candidates?.[0]?.content?.parts?.[0]?.text?.trim();
                    return generatedContext || 'General';
                } catch (error) {
                    console.error('AI context generation failed:', error);
                    return 'General';
                }
            };
            
            const handleFileUpload = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                setIsUploading(true);
                
                try {
                    const content = await file.text();
                    const lines = content.split(/[\n\r]+/).filter(line => line.trim() !== '');
                    setUploadProgress({ current: 0, total: lines.length });
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i];
                        const parts = line.split('|').map(p => p.trim());
                        const phraseText = parts[0];
                        let contextText = parts[1];
                        
                        if (!contextText && phraseText) {
                            contextText = await generateContextWithAI(phraseText);
                        }
                        
                        if (phraseText) {
                            onAdd({ type: 'phrase', mainText: phraseText, context: contextText || 'General', easiness: 2.5, interval: 0, nextReview: Date.now() });
                        }
                        setUploadProgress({ current: i + 1, total: lines.length });
                    }
                } catch (error) {
                    console.error('File parsing error:', error);
                }
                
                setIsUploading(false);
                setUploadProgress({ current: 0, total: 0 });
                e.target.value = '';
            };
            
            const inputClass = theme === 'dark' 
                ? 'bg-slate-950/50 border border-slate-700 text-slate-100 placeholder:text-slate-500 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-inner backdrop-blur-sm' 
                : 'bg-white border border-slate-200 text-slate-800 placeholder:text-slate-400 focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500/50 shadow-sm';
            
            const labelClass = theme === 'dark' ? 'text-slate-400 font-bold' : 'text-slate-500 font-bold';

            return (
                <div className="space-y-12 animate-in slide-in-from-right-4 duration-500 pt-24 pb-12 max-w-6xl mx-auto px-4">
                    {/* Edit Modal */}
                    {editingItem && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4" onClick={() => setEditingItem(null)}>
                            <div className={`${theme === 'dark' ? 'bg-slate-800 border-slate-700' : 'bg-white border-slate-200'} p-8 rounded-3xl max-w-lg w-full shadow-2xl border animate-in zoom-in-95`} onClick={e => e.stopPropagation()}>
                                <h3 className={`text-2xl font-black mb-6 ${theme === 'dark' ? 'text-white' : 'text-slate-800'}`}>Edit Phrase</h3>
                                <form onSubmit={handleEditSubmit} className="space-y-6">
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>The Phrase</label>
                                        <input value={editPhrase} onChange={e => setEditPhrase(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                    </div>
                                    <div className="space-y-2">
                                        <label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Context</label>
                                        <input value={editContext} onChange={e => setEditContext(e.target.value)} className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} />
                                    </div>
                                    <div className="flex justify-end gap-3">
                                        <button type="button" onClick={() => setEditingItem(null)} className={`px-6 py-3 rounded-xl font-bold transition-all ${theme === 'dark' ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>Cancel</button>
                                        <button type="submit" className="bg-indigo-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-indigo-700 transition-all flex items-center gap-2"><Save className="w-4 h-4" /> Save Changes</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                    
                    <ManagerContainer title="New Phrase" subtitle="Capture situational language." theme={theme}>
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div className="space-y-2"><label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>The Phrase</label><input value={phrase} onChange={e => setPhrase(e.target.value)} placeholder="e.g. Break a leg" className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} /></div>
                            <div className="space-y-2"><label className={`text-xs uppercase tracking-widest pl-1 ${labelClass}`}>Context</label><input value={context} onChange={e => setContext(e.target.value)} placeholder="e.g. Wishing luck" className={`w-full p-4 rounded-2xl outline-none font-bold transition-all ${inputClass}`} /></div>
                            <div className="flex justify-end"><button type="submit" className="bg-slate-900 text-white px-10 py-4 rounded-2xl font-bold hover:bg-slate-800 transition-all shadow-lg active:scale-95 flex items-center gap-2"><MessageCircle className="w-5 h-5" /> Save Phrase</button></div>
                        </form>
                    </ManagerContainer>
                    <ManagerContainer title="Phrases" subtitle={`${phraseItems.length} items`} theme={theme} headerAction={
                        <div className="flex items-center gap-2">
                            <input type="file" accept=".txt" ref={fileInputRef} onChange={handleFileUpload} className="hidden" disabled={isUploading} />
                            {isUploading ? (
                                <div className={`flex items-center gap-2 px-3 py-2 rounded-xl ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400' : 'bg-indigo-100 text-indigo-600'}`}>
                                    <Loader2 className="w-4 h-4 animate-spin" />
                                    <span className="text-xs font-bold">{uploadProgress.current}/{uploadProgress.total}</span>
                                </div>
                            ) : (
                                <>
                                    <button onClick={() => fileInputRef.current?.click()} title="Upload phrases from TXT file" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-indigo-500/20 text-indigo-400 hover:bg-indigo-500/30' : 'bg-indigo-100 text-indigo-600 hover:bg-indigo-200'}`}>
                                        <Upload className="w-5 h-5" />
                                    </button>
                                    {phraseItems.length > 0 && (
                                        <button onClick={() => onDeleteAll('phrase')} title="Delete all phrases" className={`p-2 rounded-xl transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-red-500/20 text-red-400 hover:bg-red-500/30' : 'bg-red-100 text-red-600 hover:bg-red-200'}`}>
                                            <Trash2 className="w-5 h-5" />
                                        </button>
                                    )}
                                </>
                            )}
                        </div>
                    }>
                        <div className="grid grid-cols-1 gap-5">{phraseItems.map(item => (<ItemCard key={item.id} type="phrase" title={item.mainText} theme={theme} subtitle={<span><span className="font-bold text-amber-500 uppercase text-[10px] tracking-wider mr-2 bg-amber-500/10 px-1.5 py-0.5 rounded">{item.context || "General"}</span></span>} icon={MessageCircle} onDelete={() => onDelete(item.id)} onEdit={() => openEditModal(item)} interval={item.interval} />))}</div>
                    </ManagerContainer>
                </div>
            );
        };

        const ReviewSession = ({ dueItems, onClose, onComplete, mode = 'srs', theme }) => {
            const [localIndex, setLocalIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            
            const currentItem = mode === 'srs' ? dueItems[0] : dueItems[localIndex];
            const totalDue = dueItems.length;

            if (!currentItem && mode === 'srs') {
                return (
                <div className="fixed inset-0 bg-slate-900/90 z-[200] flex items-center justify-center backdrop-blur-md p-4">
                    <div className={`${theme === 'dark' ? 'bg-slate-800 text-white border-slate-700' : 'bg-white text-slate-800'} p-10 rounded-3xl max-w-md w-full text-center animate-in zoom-in-95 shadow-2xl border`}>
                    <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6"><Check className="w-12 h-12 text-green-600" /></div>
                    <h2 className="text-3xl font-black mb-2">You are done with the revision!</h2>
                    <p className={`${theme === 'dark' ? 'text-gray-400' : 'text-slate-500'} mb-8 text-lg`}>Great job keeping your vocabulary fresh.</p>
                    <button onClick={onClose} className="bg-slate-900 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-slate-800 w-full transition-transform active:scale-95">Return to Dashboard</button>
                    </div>
                </div>
                );
            }

            if (mode === 'flashcard' && localIndex >= totalDue) {
                return (
                <div className="fixed inset-0 bg-slate-900/90 z-[200] flex items-center justify-center backdrop-blur-md p-4">
                    <div className={`${theme === 'dark' ? 'bg-slate-800 text-white border-slate-700' : 'bg-white text-slate-800'} p-10 rounded-3xl max-w-md w-full text-center animate-in zoom-in-95 shadow-2xl border`}>
                    <div className="w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-6"><Check className="w-12 h-12 text-indigo-600" /></div>
                    <h2 className="text-3xl font-black mb-2">You are done!</h2>
                    <p className={`${theme === 'dark' ? 'text-gray-400' : 'text-slate-500'} mb-8 text-lg`}>Great job reviewing.</p>
                    <button onClick={onClose} className="bg-slate-900 text-white px-8 py-4 rounded-xl font-bold text-lg hover:bg-slate-800 w-full transition-transform active:scale-95">Finish</button>
                    </div>
                </div>
                );
            }

            const handleSRSRate = (rating) => {
                const { interval, easiness } = calculateNextReview(rating, currentItem.interval || 0, currentItem.easiness || 2.5);
                const nextReviewDate = Date.now() + (interval * 24 * 60 * 60 * 1000);
                onComplete(currentItem.id, { interval, easiness, nextReview: nextReviewDate });
                setIsFlipped(false);
            };

            const handleFlashcardNext = () => { setLocalIndex(prev => prev + 1); setIsFlipped(false); };
            const handleBack = () => { if (localIndex > 0) { setLocalIndex(prev => prev - 1); setIsFlipped(false); } };

            const cardBg = theme === 'dark' ? 'bg-slate-800' : 'bg-white';
            const textColor = theme === 'dark' ? 'text-white' : 'text-slate-800';

            return (
                <div className="fixed inset-0 bg-slate-900/95 z-[200] flex items-center justify-center p-4 backdrop-blur-sm">
                <div className="w-full max-w-2xl flex flex-col h-[70vh]">
                    <div className="flex justify-between items-center text-white mb-4 px-2">
                        <div className="flex items-center gap-4">
                            {mode === 'flashcard' && localIndex > 0 && (
                                <button onClick={handleBack} className="p-2 hover:bg-white/10 rounded-full transition-colors"><ArrowLeft className="w-6 h-6" /></button>
                            )}
                            <span className="font-bold opacity-70">{mode === 'srs' ? `${totalDue} Cards Remaining` : `Card ${localIndex + 1} / ${totalDue}`}</span>
                        </div>
                        <button onClick={onClose} className="p-2 hover:bg-white/10 rounded-full transition-colors"><X className="w-6 h-6" /></button>
                    </div>
                    <div className={`flex-1 ${cardBg} rounded-3xl shadow-2xl relative overflow-hidden flex flex-col transition-colors duration-300`}>
                        <div className="flex-1 flex flex-col items-center justify-center text-center p-8 md:p-12">
                        <span className="inline-block px-3 py-1 rounded-full bg-slate-100 text-slate-500 text-xs font-bold tracking-widest uppercase mb-6">{currentItem.type}</span>
                        <h2 className={`text-4xl md:text-5xl font-black mb-6 leading-tight ${textColor}`}>{currentItem.mainText}</h2>
                        {currentItem.type === 'phrase' && <div className="bg-indigo-50 text-indigo-700 px-4 py-2 rounded-lg font-medium text-sm border border-indigo-100 flex items-center gap-2"><MessageCircle className="w-4 h-4" /> Context: {currentItem.context}</div>}
                        </div>
                        {isFlipped && (
                        <div className={`${theme === 'dark' ? 'bg-slate-900 border-slate-700' : 'bg-slate-50 border-slate-100'} border-t p-8 animate-in slide-in-from-bottom-10 fade-in duration-300 absolute inset-0 flex flex-col items-center justify-center z-10`}>
                            <div className="text-center">
                                    <div className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">The Answer Is</div>
                                    {currentItem.type === 'voca' && (
                                        <div className="space-y-4">
                                            <div className={`text-2xl font-medium leading-relaxed ${theme==='dark'?'text-indigo-300':'text-indigo-700'}`}>{currentItem.context}</div>
                                            {currentItem.ipa && <div className="text-sm font-mono text-slate-400">{currentItem.ipa}</div>}
                                            {currentItem.example && <div className="text-slate-500 italic">"{currentItem.example}"</div>}
                                        </div>
                                    )}
                                    {currentItem.type === 'synonym' && <div className="text-3xl font-bold text-indigo-600 leading-relaxed">{currentItem.related?.join(', ')}</div>}
                                    {currentItem.type === 'antonym' && <div className="text-4xl font-bold text-rose-600">{currentItem.related?.[0]}</div>}
                                    {currentItem.type === 'phrase' && <div className="text-xl text-indigo-700 italic font-medium max-w-lg">"Repeat this phrase out loud with proper emotion. Visualize the {currentItem.context} situation."</div>}
                            </div>
                        </div>
                        )}
                        <div className={`p-6 ${cardBg} border-t ${theme==='dark'?'border-slate-700':'border-slate-100'} z-20`}>
                        {!isFlipped ? (
                            <button onClick={() => setIsFlipped(true)} className="w-full bg-indigo-600 text-white py-5 rounded-2xl font-bold text-xl hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all active:scale-95">Reveal Answer</button>
                        ) : (
                            <div className="w-full">
                                {mode === 'srs' ? (
                                    <div className="grid grid-cols-3 gap-4">
                                        <button onClick={() => handleSRSRate(1)} className="group bg-rose-50 text-rose-700 py-4 rounded-2xl font-bold border border-rose-100 hover:bg-rose-100 hover:border-rose-200 transition-all active:scale-95"><span className="block text-xs opacity-50 uppercase mb-1 group-hover:opacity-100">Reset</span>Forgot</button>
                                        <button onClick={() => handleSRSRate(3)} className="group bg-amber-50 text-amber-700 py-4 rounded-2xl font-bold border border-amber-100 hover:bg-amber-100 hover:border-amber-200 transition-all active:scale-95"><span className="block text-xs opacity-50 uppercase mb-1 group-hover:opacity-100">Soon</span>Hard</button>
                                        <button onClick={() => handleSRSRate(5)} className="group bg-emerald-50 text-emerald-700 py-4 rounded-2xl font-bold border border-emerald-100 hover:bg-emerald-100 hover:border-emerald-200 transition-all active:scale-95"><span className="block text-xs opacity-50 uppercase mb-1 group-hover:opacity-100">4 Days</span>Easy</button>
                                    </div>
                                ) : (
                                    <div className="grid grid-cols-2 gap-4">
                                        <button onClick={handleBack} disabled={localIndex === 0} className={`bg-slate-100 text-slate-600 py-4 rounded-2xl font-bold border border-slate-200 hover:bg-slate-200 transition-all active:scale-95 flex items-center justify-center gap-2 ${localIndex === 0 ? 'opacity-50 cursor-not-allowed' : ''}`}><ArrowLeft className="w-5 h-5" /> Back</button>
                                        <button onClick={handleFlashcardNext} className="bg-indigo-600 text-white py-4 rounded-2xl font-bold hover:bg-indigo-700 transition-all active:scale-95 flex items-center justify-center gap-2">Next <Play className="w-5 h-5" /></button>
                                    </div>
                                )}
                            </div>
                        )}
                        </div>
                    </div>
                </div>
                </div>
            );
        };

        // Custom Confirmation Modal Component
        const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message, confirmText = "Delete All", theme }) => {
            if (!isOpen) return null;
            
            return (
                <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] flex items-center justify-center p-4 animate-in fade-in duration-200" onClick={onClose}>
                    <div className={`${theme === 'dark' ? 'bg-slate-800/95 border-slate-700' : 'bg-white/95 border-slate-200'} p-8 rounded-3xl max-w-md w-full shadow-2xl border backdrop-blur-xl animate-in zoom-in-95 duration-300`} onClick={e => e.stopPropagation()}>
                        <div className="text-center">
                            <div className={`w-16 h-16 mx-auto mb-5 rounded-full flex items-center justify-center ${theme === 'dark' ? 'bg-red-500/20' : 'bg-red-100'}`}>
                                <Trash2 className={`w-8 h-8 ${theme === 'dark' ? 'text-red-400' : 'text-red-500'}`} />
                            </div>
                            <h3 className={`text-2xl font-black mb-3 ${theme === 'dark' ? 'text-white' : 'text-slate-800'}`}>{title}</h3>
                            <p className={`mb-8 ${theme === 'dark' ? 'text-slate-400' : 'text-slate-600'}`}>{message}</p>
                            <div className="flex gap-3 justify-center">
                                <button 
                                    onClick={onClose} 
                                    className={`px-6 py-3 rounded-2xl font-bold transition-all hover:scale-105 active:scale-95 ${theme === 'dark' ? 'bg-slate-700 text-slate-300 hover:bg-slate-600' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                                >
                                    Cancel
                                </button>
                                <button 
                                    onClick={onConfirm} 
                                    className="px-6 py-3 rounded-2xl font-bold bg-gradient-to-r from-red-500 to-rose-500 text-white hover:from-red-600 hover:to-rose-600 transition-all hover:scale-105 active:scale-95 shadow-lg shadow-red-500/25 flex items-center gap-2"
                                >
                                    <Trash2 className="w-4 h-4" />
                                    {confirmText}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // Toast Notification Component
        const Toast = ({ message, type = 'info', onClose, theme }) => {
            useEffect(() => {
                const timer = setTimeout(onClose, 4000);
                return () => clearTimeout(timer);
            }, [onClose]);

            const icons = {
                info: <Sparkles className="w-5 h-5" />,
                success: <Check className="w-5 h-5" />,
                warning: <AlertTriangle className="w-5 h-5" />,
                error: <X className="w-5 h-5" />
            };

            const colors = {
                info: theme === 'dark' 
                    ? 'bg-indigo-500/20 border-indigo-500/30 text-indigo-300' 
                    : 'bg-indigo-50 border-indigo-200 text-indigo-700',
                success: theme === 'dark' 
                    ? 'bg-emerald-500/20 border-emerald-500/30 text-emerald-300' 
                    : 'bg-emerald-50 border-emerald-200 text-emerald-700',
                warning: theme === 'dark' 
                    ? 'bg-amber-500/20 border-amber-500/30 text-amber-300' 
                    : 'bg-amber-50 border-amber-200 text-amber-700',
                error: theme === 'dark' 
                    ? 'bg-red-500/20 border-red-500/30 text-red-300' 
                    : 'bg-red-50 border-red-200 text-red-700'
            };

            const iconBg = {
                info: theme === 'dark' ? 'bg-indigo-500/30' : 'bg-indigo-100',
                success: theme === 'dark' ? 'bg-emerald-500/30' : 'bg-emerald-100',
                warning: theme === 'dark' ? 'bg-amber-500/30' : 'bg-amber-100',
                error: theme === 'dark' ? 'bg-red-500/30' : 'bg-red-100'
            };

            return (
                <div className={`${colors[type]} backdrop-blur-xl border rounded-2xl p-4 shadow-2xl flex items-start gap-3 min-w-[320px] max-w-md animate-in slide-in-from-top-2 fade-in duration-300`}>
                    <div className={`${iconBg[type]} p-2 rounded-xl shrink-0`}>
                        {icons[type]}
                    </div>
                    <div className="flex-1 pt-0.5">
                        <p className="font-semibold text-sm leading-relaxed">{message}</p>
                    </div>
                    <button onClick={onClose} className="shrink-0 p-1 rounded-lg hover:bg-black/10 transition-colors opacity-60 hover:opacity-100">
                        <X className="w-4 h-4" />
                    </button>
                </div>
            );
        };

        // Toast Container Component
        const ToastContainer = ({ toasts, removeToast, theme }) => (
            <div className="fixed top-24 left-1/2 -translate-x-1/2 z-[300] flex flex-col gap-3">
                {toasts.map(toast => (
                    <Toast 
                        key={toast.id} 
                        message={toast.message} 
                        type={toast.type} 
                        onClose={() => removeToast(toast.id)} 
                        theme={theme} 
                    />
                ))}
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [items, setItems] = useState([]);
            const [loading, setLoading] = useState(true);
            const [activeTab, setActiveTab] = useState('landing');
            const [authError, setAuthError] = useState(null);
            const [isAdding, setIsAdding] = useState(false);
            const [streak, setStreak] = useState(1);
            
            const [reviewQueue, setReviewQueue] = useState(null);
            const [reviewMode, setReviewMode] = useState('srs'); 
            const [theme, setTheme] = useState('light');
            const toggleTheme = () => setTheme(prev => prev === 'light' ? 'dark' : 'light');
            
            // Confirmation modal state
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, type: null, count: 0 });
            
            // Toast notification state
            const [toasts, setToasts] = useState([]);
            const showToast = (message, type = 'info') => {
                const id = Date.now();
                setToasts(prev => [...prev, { id, message, type }]);
            };
            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            useEffect(() => {
                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    setUser(u);
                    setLoading(false);
                    if(u) checkStreak(u);
                });
                return () => unsubscribe();
            }, []);

            useEffect(() => {
                if (!user) return;
                const q = query(collection(db, 'artifacts', appId, 'users', user.uid, 'vocabulary'));
                const unsubscribe = onSnapshot(q, (snapshot) => {
                    const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                    setItems(data);
                }, (err) => console.error("Sync Error:", err));
                return () => unsubscribe();
            }, [user]);

            const checkStreak = async (currentUser) => {
                try {
                    const statsRef = doc(db, 'artifacts', appId, 'users', currentUser.uid, 'metadata', 'stats');
                    const statsSnap = await getDoc(statsRef);
                    const today = new Date().toDateString();
                    let newStreak = 1;
                    if (statsSnap.exists()) {
                        const data = statsSnap.data();
                        const lastLoginDate = new Date(data.lastLogin);
                        const yesterday = new Date();
                        yesterday.setDate(yesterday.getDate() - 1);
                        if (data.lastLogin === today) { newStreak = data.currentStreak; } 
                        else if (lastLoginDate.toDateString() === yesterday.toDateString()) { newStreak = data.currentStreak + 1; } 
                        else { newStreak = 1; }
                    }
                    await setDoc(statsRef, { lastLogin: today, currentStreak: newStreak }, { merge: true });
                    setStreak(newStreak);
                } catch (e) { console.error("Streak Error:", e); }
            };

            const handleAdd = async (data) => { if(user) await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'vocabulary'), data); };
            const handleDelete = async (id) => { if(user) await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'vocabulary', id)); };
            
            // Show confirmation modal for delete all
            const showDeleteAllConfirm = (type) => { 
                if(!user) return;
                const itemsToDelete = items.filter(item => item.type === type);
                if(itemsToDelete.length === 0) return;
                setConfirmModal({ isOpen: true, type, count: itemsToDelete.length });
            };
            
            // Execute delete all after confirmation
            const executeDeleteAll = async () => {
                if(!user || !confirmModal.type) return;
                const itemsToDelete = items.filter(item => item.type === confirmModal.type);
                for(const item of itemsToDelete) {
                    await deleteDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'vocabulary', item.id));
                }
                setConfirmModal({ isOpen: false, type: null, count: 0 });
            };
            
            const handleUpdate = async (id, data) => { if(user) await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'vocabulary', id), data); };
            const handleUpdateSRS = async (id, data) => {
                setReviewQueue(prevQueue => { if (!prevQueue) return null; return prevQueue.filter(item => item.id !== id); });
                if(user) await updateDoc(doc(db, 'artifacts', appId, 'users', user.uid, 'vocabulary', id), data);
            };

            const handleLogin = async () => {
                if (window.location.protocol === 'file:') {
                    showToast("Google Login requires a server. Please use the 'Live Server' extension in VS Code.", 'warning');
                    return;
                }
                const provider = new GoogleAuthProvider();
                try { await signInWithPopup(auth, provider); } catch (err) { setAuthError(err.message); }
            };

            const handleLogout = async () => { await signOut(auth); window.location.reload(); };

            const handleLoadDemo = async () => {
                if (!user) return;
                setIsAdding(true);
                const demoItems = [
                    { type: 'synonym', mainText: 'Happy', related: ['Joyful', 'Ecstatic', 'Content', 'Elated'], easiness: 2.5, interval: 0, nextReview: Date.now() - 10000 },
                    { type: 'antonym', mainText: 'Artificial', related: ['Natural'], easiness: 2.5, interval: 0, nextReview: Date.now() - 10000 },
                    { type: 'phrase', mainText: 'Could you do me a favor?', context: 'Polite Request', easiness: 2.5, interval: 0, nextReview: Date.now() - 10000 },
                    { type: 'phrase', mainText: 'It slipped my mind completely.', context: 'Apologizing for forgetting', easiness: 2.5, interval: 0, nextReview: Date.now() - 10000 }
                ];
                for (const item of demoItems) { await addDoc(collection(db, 'artifacts', appId, 'users', user.uid, 'vocabulary'), item); }
                setIsAdding(false);
            };

            const dueItems = items.filter(i => i.nextReview < Date.now());

            const startDueReview = (category = 'all') => {
                let queue = dueItems;
                if (category !== 'all') { queue = dueItems.filter(i => i.type === category); }
                if (queue.length === 0) { showToast("No due items in this category!", 'info'); return; }
                setReviewMode('srs');
                setReviewQueue(queue);
            };

            const startFlashcardSession = (type) => {
                const filtered = items.filter(i => i.type === type);
                if (filtered.length === 0) { showToast(`No ${type}s found! Add some first.`, 'info'); return; }
                const shuffled = [...filtered].sort(() => 0.5 - Math.random()).slice(0, 20); // Create copy before sort
                setReviewMode('flashcard');
                setReviewQueue(shuffled);
            };

            if (loading) return <div className="h-screen flex items-center justify-center text-indigo-400 bg-slate-900">Loading...</div>;
            if (!user) return (
                <>
                    <div className="fixed inset-0 z-[-1] bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-indigo-300 via-purple-300 to-orange-200"></div>
                    <LoginPage onLogin={handleLogin} error={authError} />
                </>
            );

            // Dynamic Background based on Theme
            const bgGradient = theme === 'dark' 
                ? 'bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-slate-900 via-indigo-950 to-slate-900' 
                : 'bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-indigo-300 via-purple-300 to-orange-200';

            return (
                <div className={`min-h-screen pb-20 selection:bg-indigo-500 selection:text-white relative transition-colors duration-500 ${theme === 'dark' ? 'text-slate-200' : 'text-slate-900'}`}>
                    <div className={`fixed inset-0 z-[-1] ${bgGradient} transition-colors duration-700`}></div>
                    
                    <Navigation activeTab={activeTab} setActiveTab={setActiveTab} user={user} onLogout={handleLogout} items={items} streak={streak} theme={theme} toggleTheme={toggleTheme} />
                    
                    <main>
                        {activeTab === 'landing' && ( <LandingPage setActiveTab={setActiveTab} theme={theme} /> )}
                        {activeTab === 'dashboard' && ( <Dashboard items={items} dueCount={dueItems.length} onReview={startDueReview} onLoadDemo={handleLoadDemo} isAdding={isAdding} onFlashcards={startFlashcardSession} theme={theme} /> )}
                        {activeTab === 'voca' && ( <VocaManager items={items} onAdd={handleAdd} onDelete={handleDelete} onDeleteAll={showDeleteAllConfirm} onUpdate={handleUpdate} theme={theme} /> )}
                        {activeTab === 'synonyms' && ( <SynonymManager items={items} onAdd={handleAdd} onDelete={handleDelete} onDeleteAll={showDeleteAllConfirm} onUpdate={handleUpdate} theme={theme} /> )}
                        {activeTab === 'antonyms' && ( <AntonymManager items={items} onAdd={handleAdd} onDelete={handleDelete} onDeleteAll={showDeleteAllConfirm} onUpdate={handleUpdate} theme={theme} /> )}
                        {activeTab === 'phrases' && ( <PhraseManager items={items} onAdd={handleAdd} onDelete={handleDelete} onDeleteAll={showDeleteAllConfirm} onUpdate={handleUpdate} theme={theme} /> )}
                    </main>
                    {reviewQueue && ( <ReviewSession dueItems={reviewQueue} mode={reviewMode} onClose={() => setReviewQueue(null)} onComplete={handleUpdateSRS} theme={theme} /> )}
                    
                    {/* Custom Confirmation Modal */}
                    <ConfirmModal 
                        isOpen={confirmModal.isOpen}
                        onClose={() => setConfirmModal({ isOpen: false, type: null, count: 0 })}
                        onConfirm={executeDeleteAll}
                        title="Delete All Items?"
                        message={`You're about to permanently delete ${confirmModal.count} ${confirmModal.type || ''} item${confirmModal.count !== 1 ? 's' : ''}. This action cannot be undone.`}
                        confirmText="Delete All"
                        theme={theme}
                    />
                    
                    {/* Toast Notifications */}
                    <ToastContainer toasts={toasts} removeToast={removeToast} theme={theme} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>